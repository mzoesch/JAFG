# JAFG UE Fork

Is required to be able to modify plugins located in the project `./Mods/` directory
as they are not correctly loaded in the solution file generated by the Unreal Automation Tool.

Fork URL:

```
https://github.com/mzoesch/ue-rel
```

Requires access to epics private repo.

# Staged Source Modifications

All engine modifications are marked with a `// <JAFG>` comment
for the modification beginning and a `// </JAFG>` comment for the end.

## Ignore Rider Plugin files with engine ini

`.gitignore`

```.gitignore
# Configs
Engine/Config/DefaultEngine.ini

# Plugins
Engine/Plugins/Marketplace/Developer/RiderLink/
```

## Change Target Rules for Unreal Game Target to link their modules to individual dynamic libraries

`./Engine/Source/UnrealGame.Target.cs::UnrealGameTarget::UnrealGameTarget`

```csharp
// <JAFG>
LinkType = TargetLinkType.Modular;
// </JAFG>
```

## Scan Mods directory plugins

`./Engine/Source/Programs/Shared/EpicGames.Build/System/Rules.cs::Rules::FindAllRulesSourceFiles`

`-> foreach (DirectoryReference RootFolder in RootFolders) { ... }`

```csharp
// <JAFG> Scan Mods Folder plugins too
DirectoryReference ModsFolder = DirectoryReference.Combine(RootFolder, "Mods");
foreach (FileReference PluginFile in PluginsBase.EnumeratePlugins(ModsFolder))
{
    Folders.Add(DirectoryReference.Combine(PluginFile.Directory, "Source"));
}
// </JAFG>
```

## Add modification targets to all project target files

`./Engine/Source/Programs/UnrealBuildTool/ProjectFiles/ProjectFileGenerator.cs::ProjectFileGenerator::GenerateProjectFiles`

`List<Tuple<ProjectFile, ProjectTarget>> AllProjectTargetFiles = new List<Tuple<ProjectFile, ProjectTarget>>(); { ... }`

```csharp
// <JAFG> Modification targets
foreach (ProjectFile ModProject in ModProjects)
{
    foreach (ProjectTarget ProjectTarget in ModProject.ProjectTargets)
    {
        if (ProjectTarget.TargetFilePath != null)
        {
            // Only bother with the editor target.  We want to make sure that definitions are setup to be as inclusive as possible
            // for good quality IntelliSense.  For example, we want WITH_EDITORONLY_DATA=1, so using the editor targets works well.
            if (ProjectTarget.TargetRules == null)
            {
                Logger.LogError("ProjectTarget.TargetRules is null for {ProjectTarget}", ProjectTarget);
            }
            else if (ProjectTarget.TargetRules.Type == TargetType.Editor)
            {
                IntelliSenseTargetFiles.Add(Tuple.Create(ModProject, ProjectTarget));
            }
        }
    }
}
// </JAFG>
```
